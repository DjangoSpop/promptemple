{% extends "mvp_ui/base.html" %}

{% block title %}Templates - PromptCraft MVP{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
            <h1><i class="bi bi-file-text"></i> Templates</h1>
            <button type="button" class="btn btn-secondary" data-action="create-template">
                <i class="bi bi-plus-circle"></i> Create Template
            </button>
        </div>
    </div>
</div>

<!-- Search & Filters -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card glass">
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-5">
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="bi bi-search"></i>
                            </span>
                            <input
                                type="text"
                                id="template-search"
                                class="form-control"
                                placeholder="Search templates by title, description, or tags..."
                                aria-label="Search templates"
                            >
                        </div>
                    </div>
                    <div class="col-md-3">
                        <select id="domain-filter" class="form-select" aria-label="Filter by domain">
                            <option value="">All Domains</option>
                            <option value="general">General</option>
                            <option value="marketing">Marketing</option>
                            <option value="code">Code</option>
                            <option value="writing">Writing</option>
                            <option value="analysis">Analysis</option>
                            <option value="education">Education</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <select id="visibility-filter" class="form-select" aria-label="Filter by visibility">
                            <option value="">All Visibility</option>
                            <option value="public">Public</option>
                            <option value="private">Private</option>
                            <option value="organization">Organization</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <select id="sort-select" class="form-select" aria-label="Sort templates">
                            <option value="-created_at">Newest First</option>
                            <option value="created_at">Oldest First</option>
                            <option value="title">Title A-Z</option>
                            <option value="-title">Title Z-A</option>
                            <option value="-usage_count">Most Used</option>
                            <option value="-popularity_score">Most Popular</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Templates Grid -->
<div class="row" id="templates-grid">
    {% if templates %}
        {% for template in templates %}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card template-card h-100" data-template-id="{{ template.id }}">
                <div class="card-body">
                    <!-- Header with domain badge -->
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h5 class="card-title mb-0">
                            {{ template.title }}
                        </h5>
                        {% if template.domain %}
                        <span class="badge badge-domain">{{ template.domain }}</span>
                        {% endif %}
                    </div>

                    <!-- Description -->
                    <p class="card-text text-muted small mb-3">
                        {{ template.description|truncatewords:15|default:"No description provided" }}
                    </p>

                    <!-- Tags -->
                    {% if template.tags %}
                    <div class="d-flex flex-wrap gap-1 mb-3">
                        {% for tag in template.tags|slice:":3" %}
                        <span class="badge bg-light text-dark border">
                            <i class="bi bi-tag-fill"></i> {{ tag }}
                        </span>
                        {% endfor %}
                        {% if template.tags|length > 3 %}
                        <span class="badge bg-light text-dark border">
                            +{{ template.tags|length|add:"-3" }}
                        </span>
                        {% endif %}
                    </div>
                    {% endif %}

                    <!-- Metadata -->
                    <div class="d-flex justify-content-between align-items-center mt-auto">
                        <div class="d-flex gap-2">
                            <!-- Visibility badge -->
                            {% if template.is_public %}
                            <span class="badge bg-success">
                                <i class="bi bi-globe"></i> Public
                            </span>
                            {% else %}
                            <span class="badge bg-secondary">
                                <i class="bi bi-lock"></i> Private
                            </span>
                            {% endif %}

                            <!-- Quality score badge (if available) -->
                            {% if template.quality_score %}
                            <span class="badge badge-quality">
                                <i class="bi bi-star-fill"></i> {{ template.quality_score }}
                            </span>
                            {% endif %}
                        </div>

                        <!-- Usage count -->
                        <small class="text-muted">
                            <i class="bi bi-eye"></i> {{ template.usage_count|default:0 }}
                        </small>
                    </div>
                </div>

                <!-- Quick Actions Footer -->
                <div class="card-footer bg-transparent border-top">
                    <div class="d-flex gap-2 justify-content-between">
                        <button
                            type="button"
                            class="btn btn-sm btn-outline-primary flex-fill"
                            data-action="preview-template"
                            data-template-id="{{ template.id }}"
                            title="Preview template"
                        >
                            <i class="bi bi-eye"></i>
                        </button>
                        <button
                            type="button"
                            class="btn btn-sm btn-outline-secondary flex-fill"
                            data-action="edit-template"
                            data-template-id="{{ template.id }}"
                            title="Edit template"
                        >
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button
                            type="button"
                            class="btn btn-sm btn-outline-info flex-fill"
                            data-action="duplicate-template"
                            data-template-id="{{ template.id }}"
                            title="Duplicate template"
                        >
                            <i class="bi bi-files"></i>
                        </button>
                        <button
                            type="button"
                            class="btn btn-sm btn-outline-danger flex-fill"
                            data-action="delete-template"
                            data-template-id="{{ template.id }}"
                            title="Delete template"
                        >
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>

                <!-- Hover overlay for desktop -->
                <div class="card-hover-overlay d-none d-md-block">
                    <div class="d-flex flex-column gap-2 p-3">
                        <button
                            type="button"
                            class="btn btn-primary btn-sm"
                            data-action="preview-template"
                            data-template-id="{{ template.id }}"
                        >
                            <i class="bi bi-eye"></i> Preview
                        </button>
                        <button
                            type="button"
                            class="btn btn-secondary btn-sm"
                            data-action="edit-template"
                            data-template-id="{{ template.id }}"
                        >
                            <i class="bi bi-pencil"></i> Edit
                        </button>
                        <button
                            type="button"
                            class="btn btn-info btn-sm"
                            data-action="duplicate-template"
                            data-template-id="{{ template.id }}"
                        >
                            <i class="bi bi-files"></i> Duplicate
                        </button>
                        <button
                            type="button"
                            class="btn btn-danger btn-sm"
                            data-action="delete-template"
                            data-template-id="{{ template.id }}"
                        >
                            <i class="bi bi-trash"></i> Delete
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
    <div class="col-12">
        <div class="alert alert-info text-center glass">
            <i class="bi bi-info-circle" style="font-size: 3rem;"></i>
            <h4 class="mt-3">No templates found</h4>
            <p>Start building your prompt library by creating your first template.</p>
            <button type="button" class="btn btn-primary mt-2" data-action="create-template">
                <i class="bi bi-plus-circle"></i> Create Your First Template
            </button>
        </div>
    </div>
    {% endif %}
</div>

<!-- Pagination -->
{% if pagination.count > 0 %}
<nav aria-label="Template pagination" class="mt-4">
    <ul class="pagination justify-content-center">
        {% if pagination.previous %}
        <li class="page-item">
            <a class="page-link" href="?page={{ pagination.current_page|add:"-1" }}">
                <i class="bi bi-chevron-left"></i> Previous
            </a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link">
                <i class="bi bi-chevron-left"></i> Previous
            </span>
        </li>
        {% endif %}

        <li class="page-item disabled">
            <span class="page-link">
                Page {{ pagination.current_page }} of {{ pagination.count }}
            </span>
        </li>

        {% if pagination.next %}
        <li class="page-item">
            <a class="page-link" href="?page={{ pagination.current_page|add:"1" }}">
                Next <i class="bi bi-chevron-right"></i>
            </a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link">
                Next <i class="bi bi-chevron-right"></i>
            </span>
        </li>
        {% endif %}
    </ul>
</nav>
{% endif %}

<!-- Loading State (hidden by default) -->
<div id="loading-state" class="text-center py-5" style="display: none;">
    <div class="spinner mb-3"></div>
    <p class="text-muted">Loading templates...</p>
</div>

<!-- Custom Styles for Template Cards -->
<style>
/* Template card enhancements */
.template-card {
    position: relative;
    overflow: hidden;
    transition: all var(--transition-base);
}

.template-card:hover {
    transform: translateY(-8px);
}

.template-card .card-hover-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 43, 69, 0.95);
    backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all var(--transition-base);
    z-index: 10;
}

.template-card:hover .card-hover-overlay {
    opacity: 1;
    visibility: visible;
}

/* Hide footer on desktop hover */
@media (min-width: 768px) {
    .template-card:hover .card-footer {
        opacity: 0;
    }
}

/* Badge animations */
.badge {
    animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
}

/* Search input focus effect */
#template-search:focus {
    box-shadow: 0 0 0 4px rgba(181, 142, 31, 0.15);
}

/* Loading skeleton for future enhancement */
.skeleton-card {
    animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Initialize template CRUD functionality
document.addEventListener('DOMContentLoaded', function() {
    console.log('Template list enhanced with modal functionality');

    // Add smooth scroll for pagination
    document.querySelectorAll('.pagination a').forEach(link => {
        link.addEventListener('click', function(e) {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    });
});
</script>
{% endblock %}
